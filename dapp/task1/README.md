# Task1 - ä»¥å¤ªåŠåŒºå—ã€äº¤æ˜“å’Œåˆçº¦æ“ä½œå·¥å…·

ä¸€ä¸ªåŸºäºGoè¯­è¨€å¼€å‘çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæŸ¥è¯¢ä»¥å¤ªåŠSepoliaæµ‹è¯•ç½‘ç»œçš„åŒºå—ä¿¡æ¯ã€æ‰§è¡Œä»¥å¤ªåŠäº¤æ˜“ä»¥åŠéƒ¨ç½²å’Œè°ƒç”¨æ™ºèƒ½åˆçº¦ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **åŒºå—æŸ¥è¯¢**: æ ¹æ®åŒºå—IDæŸ¥è¯¢åŒºå—è¯¦ç»†ä¿¡æ¯ï¼ˆå“ˆå¸Œã€æ—¶é—´æˆ³ã€äº¤æ˜“æ•°é‡ï¼‰
- ğŸ’° **äº¤æ˜“æ‰§è¡Œ**: æ‰§è¡Œä»¥å¤ªåŠè½¬è´¦äº¤æ˜“ï¼Œæ”¯æŒè‡ªå®šä¹‰é‡‘é¢å’Œå°æ•°ä½æ•°
- ğŸ“ **åˆçº¦æ“ä½œ**: éƒ¨ç½²å’Œè°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Œæ”¯æŒè®¡æ•°å™¨åˆçº¦åŠŸèƒ½
- âš¡ **å®æ—¶ç›‘æ§**: è‡ªåŠ¨ç›‘å¬äº¤æ˜“çŠ¶æ€ï¼Œæ˜¾ç¤ºäº¤æ˜“æ”¶æ®ä¿¡æ¯
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰ç¯å¢ƒå˜é‡æ–‡ä»¶è·¯å¾„
- ğŸ›¡ï¸ **å®‰å…¨å¯é **: ä½¿ç”¨EIP-155ç­¾åå™¨è¿›è¡Œäº¤æ˜“ç­¾å

## é¡¹ç›®ç»“æ„

```
task1/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go              # å‘½ä»¤è¡Œå…¥å£ï¼Œä½¿ç”¨cobraæ¡†æ¶
â”œâ”€â”€ blocks/
â”‚   â””â”€â”€ blocks.go            # åŒºå—æŸ¥è¯¢åŠŸèƒ½
â”œâ”€â”€ transactions/
â”‚   â””â”€â”€ transactions.go      # äº¤æ˜“æ‰§è¡ŒåŠŸèƒ½
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ contracts.go         # åˆçº¦ç»‘å®šä»£ç ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ service.go           # åˆçº¦æœåŠ¡å±‚
â”‚   â”œâ”€â”€ counting.sol         # è®¡æ•°å™¨åˆçº¦æºä»£ç 
â”‚   â”œâ”€â”€ counting_sol_Counting.abi  # åˆçº¦ABIæ–‡ä»¶
â”‚   â””â”€â”€ counting_sol_Counting.bin  # åˆçº¦å­—èŠ‚ç æ–‡ä»¶
â”œâ”€â”€ util/
â”‚   â”œâ”€â”€ config.go            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ common.go            # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ .env.template        # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ go.mod                   # Goæ¨¡å—ä¾èµ–
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

1. **Goç¯å¢ƒ**: éœ€è¦å®‰è£…Go 1.25æˆ–æ›´é«˜ç‰ˆæœ¬
2. **ä»¥å¤ªåŠè´¦æˆ·**: éœ€è¦æ‹¥æœ‰Sepoliaæµ‹è¯•ç½‘ç»œçš„ä»¥å¤ªåŠè´¦æˆ·å’Œç§é’¥
3. **Infuraè´¦æˆ·**: éœ€è¦æ³¨å†ŒInfuraè´¦æˆ·è·å–APIå¯†é’¥

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   cd dapp/task1
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   go mod tidy
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   
   åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
   ```env
   API_KEY=your_infura_api_key_here
   PRIVATE_KEY=your_wallet_private_key_here
   ```
   
   > **æ³¨æ„**: è¯·ç¡®ä¿ç§é’¥ä»¥ `0x` å¼€å¤´

4. **æ„å»ºé¡¹ç›®**
   ```bash
   go build -o task1 cmd/main.go
   ```

## ä½¿ç”¨è¯´æ˜

### åŒºå—æŸ¥è¯¢

æŸ¥è¯¢æŒ‡å®šåŒºå—å·çš„è¯¦ç»†ä¿¡æ¯ï¼š

```bash
# æŸ¥è¯¢åŒºå— 1000000 çš„ä¿¡æ¯
./task1 blocks --id 1000000

# æˆ–è€…ä½¿ç”¨çŸ­å‚æ•°
./task1 blocks -i 1000000
```

**è¾“å‡ºç¤ºä¾‹**:
```
åŒºå— 1000000 çš„å“ˆå¸Œ: 0x1234...abcd
åŒºå— 1000000 çš„æ—¶é—´æˆ³: 1712345678
åŒºå— 1000000 çš„äº¤æ˜“æ•°é‡: 42
```

### äº¤æ˜“æ‰§è¡Œ

æ‰§è¡Œä»¥å¤ªåŠè½¬è´¦äº¤æ˜“ï¼š

```bash
# å‘æŒ‡å®šåœ°å€è½¬è´¦ 0.001 ETH
./task1 transactions --to 0x742d35Cc6634C0532925a3b8D4B8cD44e6d8d4c9 --amount 1 --digits 15

# æˆ–è€…ä½¿ç”¨çŸ­å‚æ•°
./task1 transactions -t 0x742d35Cc6634C0532925a3b8D4B8cD44e6d8d4c9 -a 1 -d 15
```

**å‚æ•°è¯´æ˜**:
- `--to/-t`: æ¥æ”¶åœ°å€ï¼ˆå¿…éœ€ï¼‰
- `--amount/-a`: è½¬è´¦é‡‘é¢ï¼ˆå¿…éœ€ï¼Œæ­£æ•´æ•°ï¼‰
- `--digits/-d`: å°æ•°ä½æ•°ï¼ˆå¿…éœ€ï¼Œ0-18ï¼‰

**é‡‘é¢è®¡ç®—è§„åˆ™**:
- æœ€ç»ˆè½¬è´¦é‡‘é¢ = `amount * 10^digits` wei
- ä¾‹å¦‚: `amount=1, digits=18` è¡¨ç¤º 1 ETH
- ä¾‹å¦‚: `amount=1, digits=15` è¡¨ç¤º 0.001 ETH

### åˆçº¦æ“ä½œ

#### éƒ¨ç½²åˆçº¦

éƒ¨ç½²è®¡æ•°å™¨åˆçº¦åˆ°ä»¥å¤ªåŠç½‘ç»œï¼š

```bash
# éƒ¨ç½²åˆçº¦
./task1 contracts deploy

# é‡æ–°éƒ¨ç½²åˆçº¦ï¼ˆè¦†ç›–å†å²éƒ¨ç½²ï¼‰
./task1 contracts deploy --redeploy

# ä½¿ç”¨è‡ªå®šä¹‰åˆçº¦åœ°å€ä¿å­˜è·¯å¾„
./task1 contracts deploy --path /custom/path/contracts.address
```

#### è°ƒç”¨åˆçº¦

è°ƒç”¨å·²éƒ¨ç½²çš„åˆçº¦æ–¹æ³•ï¼š

```bash
# æŸ¥è¯¢å½“å‰è®¡æ•°å€¼ï¼ˆåªè¯»æ“ä½œï¼‰
./task1 contracts call --method count

# å¢åŠ è®¡æ•°å€¼ï¼ˆå†™å…¥æ“ä½œï¼Œéœ€è¦æ¶ˆè€—gasï¼‰
./task1 contracts call --method increment

# ä½¿ç”¨è‡ªå®šä¹‰åˆçº¦åœ°å€æ–‡ä»¶è·¯å¾„
./task1 contracts call --method count --path /custom/path/contracts.address
```

**åˆçº¦æ–¹æ³•è¯´æ˜**:
- `count`: æŸ¥è¯¢å½“å‰è®¡æ•°å€¼ï¼ˆåªè¯»ï¼Œä¸æ¶ˆè€—gasï¼‰
- `increment`: å¢åŠ è®¡æ•°å€¼ï¼ˆå†™å…¥ï¼Œéœ€è¦æ¶ˆè€—gasï¼‰

### é«˜çº§ç”¨æ³•

**ä½¿ç”¨è‡ªå®šä¹‰ç¯å¢ƒæ–‡ä»¶**:
```bash
./task1 --env-file /path/to/custom.env blocks -i 1000000
```

**ç”Ÿæˆç¯å¢ƒå˜é‡æ¨¡æ¿**:
```bash
./task1 --env-template
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `API_KEY` | Infura APIå¯†é’¥ | `your_infura_api_key` |
| `PRIVATE_KEY` | ä»¥å¤ªåŠé’±åŒ…ç§é’¥ | `0x123...abc` |

### ç½‘ç»œé…ç½®

- **ä¸»ç½‘ç»œ**: Sepoliaæµ‹è¯•ç½‘ç»œ
- **RPCç«¯ç‚¹**: `https://sepolia.infura.io/v3/<API_KEY>`
- **WebSocketç«¯ç‚¹**: `wss://ethereum-sepolia-rpc.publicnode.com`

## æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–åº“

- `github.com/ethereum/go-ethereum`: ä»¥å¤ªåŠGoå®¢æˆ·ç«¯
- `github.com/spf13/cobra`: å‘½ä»¤è¡Œæ¡†æ¶
- `github.com/spf13/viper`: é…ç½®ç®¡ç†
- `github.com/valyala/fasttemplate`: æ¨¡æ¿å¤„ç†

### æ ¸å¿ƒåŠŸèƒ½

1. **åŒºå—æŸ¥è¯¢** ([`blocks.QueryById()`](dapp/task1/blocks/blocks.go:13))
   - ä½¿ç”¨ `BlockByNumber` æ–¹æ³•æŸ¥è¯¢åŒºå—ä¿¡æ¯
   - è¿”å›åŒºå—å“ˆå¸Œã€æ—¶é—´æˆ³ã€äº¤æ˜“æ•°é‡

2. **äº¤æ˜“æ‰§è¡Œ** ([`transactions.Transactions()`](dapp/task1/transactions/transactions.go:35))
   - æ„é€ æœªç­¾åäº¤æ˜“
   - ä½¿ç”¨EIP-155ç­¾åå™¨ç­¾å
   - å‘é€äº¤æ˜“åˆ°ç½‘ç»œå¹¶ç›‘æ§çŠ¶æ€

3. **åˆçº¦æ“ä½œ** ([`contracts.NewContractService()`](dapp/task1/contracts/service.go:27))
   - **åˆçº¦éƒ¨ç½²** ([`contracts.Deploy()`](dapp/task1/contracts/service.go:92)): éƒ¨ç½²è®¡æ•°å™¨åˆçº¦åˆ°ä»¥å¤ªåŠç½‘ç»œ
   - **åˆçº¦è°ƒç”¨** ([`contracts.Count()`](dapp/task1/contracts/service.go:175), [`contracts.Increment()`](dapp/task1/contracts/service.go:188)): è°ƒç”¨åˆçº¦çš„åªè¯»å’Œå†™å…¥æ–¹æ³•
   - **åœ°å€ç®¡ç†**: è‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½åˆçº¦åœ°å€åˆ°æœ¬åœ°æ–‡ä»¶

4. **é…ç½®ç®¡ç†** ([`util.InitConfig()`](dapp/task1/util/config.go:25))
   - æ”¯æŒè‡ªå®šä¹‰ç¯å¢ƒæ–‡ä»¶è·¯å¾„
   - è‡ªåŠ¨æœç´¢é…ç½®æ–‡ä»¶
   - å®æ—¶é…ç½®ç›‘å¬

### åˆçº¦è¯¦æƒ…

**è®¡æ•°å™¨åˆçº¦** ([`contracts/counting.sol`](dapp/task1/contracts/counting.sol:1)):
```solidity
// SPDX-License-Identifier: SEE LICENSE IN LICENSE
pragma solidity ^0.8.0;

contract Counting {
    uint256 public count;

    function increment() public {
        count++;
    }
}
```

**åˆçº¦åŠŸèƒ½**:
- `count`: å…¬å…±çŠ¶æ€å˜é‡ï¼Œå­˜å‚¨å½“å‰è®¡æ•°å€¼
- `increment()`: å…¬å…±å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨å°†è®¡æ•°å€¼åŠ 1

**åˆçº¦åœ°å€ç®¡ç†**:
- é»˜è®¤ä¿å­˜è·¯å¾„: `~/.task1_contractsAddress`
- æ”¯æŒè‡ªå®šä¹‰ä¿å­˜è·¯å¾„
- è‡ªåŠ¨åŠ è½½å†å²éƒ¨ç½²çš„åˆçº¦åœ°å€

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œä»£ç†è®¾ç½®
   - éªŒè¯APIå¯†é’¥æ˜¯å¦æ­£ç¡®

2. **äº¤æ˜“å¤±è´¥**
   - ç¡®è®¤è´¦æˆ·æœ‰è¶³å¤Ÿçš„ETHä½™é¢
   - æ£€æŸ¥ç§é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®
   - éªŒè¯æ¥æ”¶åœ°å€æ ¼å¼

3. **åˆçº¦æ“ä½œå¤±è´¥**
   - ç¡®ä¿åˆçº¦å·²æ­£ç¡®éƒ¨ç½²
   - æ£€æŸ¥åˆçº¦åœ°å€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - ç¡®è®¤è°ƒç”¨çš„æ˜¯æ­£ç¡®çš„åˆçº¦æ–¹æ³•
   - éªŒè¯è´¦æˆ·æœ‰è¶³å¤Ÿçš„gasè´¹ç”¨

4. **é…ç½®é”™è¯¯**
   - ç¡®ä¿ `.env` æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®
   - æ£€æŸ¥ç¯å¢ƒå˜é‡åç§°å’Œå€¼

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼š
```bash
go run cmd/main.go -v blocks -i 1000000
```

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œæµ‹è¯•ç›®çš„ï¼Œè¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çœŸå®çš„ç§é’¥ã€‚