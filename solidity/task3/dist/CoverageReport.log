[dotenv@17.2.3] injecting env (4) from .env -- tip: ✅ audit secrets and track compliance: https://dotenvx.com/ops

Version
=======
> solidity-coverage: v0.8.16

Instrumenting for coverage...
=============================

> ConvertPrice.sol
> MockUSDC.sol
> MyNFT.sol
> MyNFTV2.sol
> NFTAuction.sol
> NFTAuctionFactory.sol
> NFTAuctionFactoryV2.sol
> NFTAuctionV2.sol
> SimpleAuction.sol

Compilation:
============

Generating typings for: 47 artifacts in dir: typechain-types for target: ethers-v6
Successfully generated 156 typings!
Compiled 47 Solidity files successfully (evm target: paris).

Network Info
============
> HardhatEVM: v2.26.4
> network:    hardhat



  MyNFT Upgrade
    ✔ 测试deploy的MyNFT合约部署初始状态验证
    ✔ 测试MintNFT传入空url是否抛错
    ✔ 测试MintNFT重复mint同一tokenId行为
    ✔ 测试只有owner能执行升级操作的权限测试
    ✔ 测试initialize函数只能调用一次
    ✔ 验证MintNFT访问控制权限(调用者限制)
    ✔ 测试upgrade的MyNFT合约升级V2 (79ms)
    MyNFT Upgrade V2 Test
      ✔ 测试升级后数据保持正确
      ✔ 升级合约后铸造新NFT
      ✔ V2 新增函数测试

  ConvertPrice
ETH to USD:  100n
USDC to USD:  200n
    ✔ test getChainlinkDataFeedLatestAnswer
ETH to USD:  10000n
USDC to USD:  20000n
    ✔ test convert
    权限控制测试
      ✔ 只有所有者可以设置预言机地址
      ✔ 设置预言机地址后应能正确获取价格
    错误处理测试
      ✔ 未设置预言机地址时应正确处理
      ✔ 零金额转换应返回零

  NFT拍卖合约
    部署与初始化
      ✔ 应该正确部署并初始化
    创建拍卖
      ✔ 应当成功创建一个拍卖
      ✔ 起始价格为零时应当回退
      ✔ 拍卖持续时间太短时应当回退
      ✔ 调用者非NFT所有者或未获授权应当回退
    出价(ETH)
      ✔ 拍卖未开始应当回退
      ✔ 出价金额为零应当回退
      ✔ 出价金额低于起始价应当回退
      ✔ 应成功进行第一次出价(ETH)
      ✔ 应成功进行更高出价并退还前一出价者(ETH)
    出价(USDC)
      ✔ 应成功进行第一次出价(USDC)
      ✔ 应成功进行更高出价并退还前一出价者(USDC)
    结束拍卖
      ✔ 拍卖未结束应当回退
      ✔ 应成功结束拍卖并转移NFT和ETH给赢家和卖家
      ✔ 无出价结束拍卖时，应将NFT返还卖家 (40ms)
      ✔ 拍卖已结束时应当回退
    取消拍卖
      ✔ 卖家应能成功取消拍卖
      ✔ 非卖家取消拍卖应失败
      ✔ 已结束的拍卖不能取消
      ✔ 无出价时取消拍卖应成功
      ✔ USDC 出价的拍卖取消应正确退款
    转账失败处理
      ✔ 转账失败时应正确处理
    setUsdcTokenAddress 功能测试
      ✔ 只有所有者可以设置 USDC 地址
    手续费功能测试
      ✔ 应正确计算手续费
      ✔ 结束拍卖时应收取手续费并累计
      ✔ USDC 拍卖结束时应收取 USDC 手续费
      ✔ 取消拍卖时不应收取手续费
      ✔ 只有所有者可以设置手续费比例
      ✔ 设置手续费比例不能超过10%
      ✔ 只有所有者可以提取手续费
      ✔ 无手续费可提取时应回退
    错误组合测试
      ✔ 同时使用 ETH 和 USDC 出价应失败
      ✔ 不支持的代币出价应失败
    NFT拍卖 Upgrade V2 Test
      ✔ V2 新增函数测试
      ✔ V2 初始化函数测试 (41ms)
      部署与初始化
        ✔ 应该正确部署并初始化
      创建拍卖
        ✔ 应当成功创建一个拍卖
        ✔ 起始价格为零时应当回退
        ✔ 拍卖持续时间太短时应当回退
        ✔ 调用者非NFT所有者或未获授权应当回退
      出价(ETH)
        ✔ 拍卖未开始应当回退
        ✔ 出价金额为零应当回退
        ✔ 出价金额低于起始价应当回退
        ✔ 应成功进行第一次出价(ETH)
        ✔ 应成功进行更高出价并退还前一出价者(ETH)
      出价(USDC)
        ✔ 应成功进行第一次出价(USDC)
        ✔ 应成功进行更高出价并退还前一出价者(USDC)
      结束拍卖
        ✔ 拍卖未结束应当回退
        ✔ 应成功结束拍卖并转移NFT和ETH给赢家和卖家
        ✔ 无出价结束拍卖时，应将NFT返还卖家
        ✔ 拍卖已结束时应当回退
      取消拍卖
        ✔ 卖家应能成功取消拍卖
        ✔ 非卖家取消拍卖应失败
        ✔ 已结束的拍卖不能取消
        ✔ 无出价时取消拍卖应成功
        ✔ USDC 出价的拍卖取消应正确退款 (40ms)
      转账失败处理
        ✔ 转账失败时应正确处理
      setUsdcTokenAddress 功能测试
        ✔ 只有所有者可以设置 USDC 地址
      手续费功能测试
        ✔ 应正确计算手续费
        ✔ 结束拍卖时应收取手续费并累计
        ✔ USDC 拍卖结束时应收取 USDC 手续费 (39ms)
        ✔ 取消拍卖时不应收取手续费
        ✔ 只有所有者可以设置手续费比例
        ✔ 设置手续费比例不能超过10%
        ✔ 只有所有者可以提取手续费
        ✔ 无手续费可提取时应回退
      错误组合测试
        ✔ 同时使用 ETH 和 USDC 出价应失败
        ✔ 不支持的代币出价应失败

  NFT拍卖工厂合约
    合约部署与初始化
      ✔ 应该正确部署并初始化工厂合约
      ✔ 应该正确设置初始状态变量
    合约部署与升级
      ✔ 应该正确实现可升级模式
      ✔ 应该正确升级
      ✔ 应该正确升级并且新函数可用
    拍卖管理功能
      ✔ 应该正确返回空拍卖列表
      ✔ 应该正确通过ID获取特定拍卖
      ✔ 应该正确维护拍卖计数器
    访问控制和安全
      ✔ 应该正确实施onlyOwner修饰符
      ✔ 应该正确处理所有权转移
      ✔ 应该正确处理所有权放弃
      ✔ 应该防止重入攻击
    边缘情况和集成测试
      ✔ 应该正确处理不同的合约状态
      ✔ 应该正确处理无效参数
      ✔ 应该与NFT合约正确集成
      ✔ 应该与USDC合约正确集成
    事件测试
      ✔ 应该正确发出所有权转移事件
      ✔ 应该正确发出初始化事件
    状态变量测试
      ✔ 应该正确访问公共状态变量
      ✔ 应该正确处理状态变量边界
    拍卖创建功能
      ✔ 应该成功创建拍卖合约
      ✔ 应该成功创建多个拍卖合约
      ✔ 非所有者创建拍卖应失败
      ✔ 应该正确处理拍卖合约交互
    集成功能测试
      ✔ 应该正确维护合约关系
    完整拍卖流程测试
      ✔ 应该成功完成完整拍卖流程 - 有出价者获胜
      ✔ 应该成功完成完整拍卖流程 - 无人出价
      ✔ 应该成功取消拍卖
      ✔ 非卖家不能结束拍卖
      ✔ 非卖家不能取消拍卖
      ✔ 拍卖未结束不能结束
      ✔ 拍卖已结束不能取消
      ✔ 出价必须高于当前最高价
      ✔ 拍卖结束后不能出价
      ✔ 拍卖取消后不能出价
      ✔ 应该正确处理多个出价者的退款


  120 passing (7s)

--------------------------|----------|----------|----------|----------|----------------|
File                      |  % Stmts | % Branch |  % Funcs |  % Lines |Uncovered Lines |
--------------------------|----------|----------|----------|----------|----------------|
 contracts\               |    97.71 |       78 |    97.22 |    93.51 |                |
  ConvertPrice.sol        |      100 |       75 |      100 |      100 |                |
  MockUSDC.sol            |      100 |      100 |      100 |      100 |                |
  MyNFT.sol               |      100 |       90 |      100 |      100 |                |
  MyNFTV2.sol             |      100 |      100 |      100 |      100 |                |
  NFTAuction.sol          |     96.1 |       76 |    91.67 |    90.16 |... 532,533,534 |
  NFTAuctionFactory.sol   |      100 |    66.67 |      100 |      100 |                |
  NFTAuctionFactoryV2.sol |      100 |      100 |      100 |      100 |                |
  NFTAuctionV2.sol        |      100 |       50 |      100 |      100 |                |
  SimpleAuction.sol       |      100 |    85.71 |      100 |      100 |                |
--------------------------|----------|----------|----------|----------|----------------|
All files                 |    97.71 |       78 |    97.22 |    93.51 |                |
--------------------------|----------|----------|----------|----------|----------------|

> Istanbul reports written to ./coverage/ and ./coverage.json
